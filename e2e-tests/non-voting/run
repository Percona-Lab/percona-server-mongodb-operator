#!/bin/bash

set -o errexit
set -o xtrace

test_dir=$(realpath $(dirname $0))
. ${test_dir}/../functions

main() {
	deploy_cert_manager
	create_namespace $namespace
	deploy_operator
	kubectl_bin apply \
		-f $conf_dir/client.yml \
		-f $conf_dir/secrets.yml

	desc "check non-voting members"
	spinup_psmdb "nonvoting-rs0" "$test_dir/conf/$cluster.yml"

	destroy $namespace
}

main
